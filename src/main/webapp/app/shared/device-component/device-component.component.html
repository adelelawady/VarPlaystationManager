<div
  class="card border"
  [ngClass]="{
    'border-3': isSelected,
    'border-success border-active': device.session,
    'border-danger': !device.session
  }"
>
  <div class="card-body">
    <h5 class="card-title">
      <span style="cursor: pointer" data-toggle="modal" [attr.data-target]="'#modal' + device.id">
        <a (click)="OnDeviceClicked()" href="#" class="card-link"> {{ device.name }}</a></span
      >
      <i
        [id]="'device-' + device.id + '-Orderselector'"
        *ngIf="device.session"
        style="cursor: pointer"
        (click)="selectDevice(device)"
        class="float-right"
        class="fa fa-cart-arrow-down text-success float-right rounded p-1"
      ></i>
    </h5>
    <h6 class="card-subtitle mb-2 text-muted my-3">{{ device.type }}</h6>
    <span *ngIf="device.session && device.session.multi">
      <small class="border bg-light text-danger p-1 rounded"> <i class="fa fa-gamepad mr-2"> </i>{{ 'multi' }}</small>
    </span>
  </div>
  <div *ngIf="device.session" class="card-footer p-2">
    <a href="#" class="card-link">
      <label class="badge badge-success">{{ (device.session.start | countdowntimer | async) || '0 m' }}</label></a
    >
    <a href="#" class="card-link float-right m-0 pr-2">{{ device | devicePrice: false:0:0:false:false:true | async }}</a>
  </div>
  <div *ngIf="!device.session" class="card-footer p-2">
    <a href="#" class="card-link float-left">
      <label class="badge badge-danger">{{ 'متوقف' }}</label></a
    >
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modal{{ device.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog rounded-lg border">
    <div class="modal-content">
      <div class="modal-header">
        <div class="card-body">
          <h5 class="card-title">
            <span style="cursor: pointer" data-toggle="modal" [attr.data-target]="'#modal' + device.id">
              <a href="#" class="card-link"> {{ device.name }}</a></span
            >
          </h5>
          <h6 class="card-subtitle mb-2 text-muted my-3">
            {{ device.type }}

            <span *ngIf="device.session && device.session.multi">
              -
              <small class="border bg-light text-danger p-1 rounded"> <i class="fa fa-gamepad mr-2"> </i>{{ 'multi' }}</small>
            </span>
          </h6>
        </div>
      </div>
      <div class="modal-body">
        <form>
          <div *ngIf="device.session" class="form-group row">
            <div class="col text-left" style="text-align: right">
              <label class="badge badge-success">{{ (device.session.start | countdowntimer | async) || '0 m' }}</label>
            </div>
            <label for="staticEmail" class="col-auto">الوقت</label>
          </div>
          <div *ngIf="device.session" class="form-group row">
            <div class="col text-left" style="text-align: right">
              <a href="#" class="card-link">{{
                (device | devicePrice: false:timeDiscount:ordersDiscount:false:false:true | async) || '0 LE'
              }}</a>
            </div>
            <label for="staticEmail" class="col-auto">السعر</label>
          </div>

          <div *ngIf="device.session && (timeDiscount > 0 || ordersDiscount > 0)" class="form-group row">
            <div class="col text-left" style="text-align: right">
              <a href="#" class="text-danger">{{ (device | devicePrice: false:0:0:false:false:true | async) || '0 LE' }}</a>
            </div>
            <label for="staticEmail" class="col-auto"> السعر قبل الخصم</label>
          </div>

          <div *ngIf="device.session" class="form-group row">
            <div class="col text-left" style="text-align: right">
              <a href="#" class="card-link">{{ device.session.start | date: 'shortTime' }}</a>
            </div>
            <label for="staticEmail" class="col-auto">وقت البدا</label>
          </div>

          <div
            *ngIf="device.session"
            class="row text-center align-center justify-content-center card-subtitle m-3 rounded border border-2 shadow-sm"
          >
            <small *ngIf="device && device.session && device.session.ordersPrice" for="staticEmail" class="col text-right"
              >{{ (device | devicePrice: false:timeDiscount:ordersDiscount:false:true | async) || '0 LE' }} : حساب الطلبات</small
            >

            <small *ngIf="device && device.session" for="staticEmail" class="col text-right">
              {{ (device | devicePrice: false:timeDiscount:ordersDiscount:true:false | async) || '0 LE' }} :حساب الوقت</small
            >
          </div>

          <div
            *ngIf="device.session && (timeDiscount > 0 || ordersDiscount > 0)"
            class="row text-center align-center justify-content-center card-subtitle m-3 rounded border border-2 shadow-sm"
          >
            <small *ngIf="device && device.session && device.session.ordersPrice" for="staticEmail" class="col text-right text-danger"
              >{{ (device | devicePrice: false:0:0:false:true | async) || '0 LE' }} : حساب الطلبات قبل الخصم</small
            >

            <small *ngIf="device && device.session" for="staticEmail" class="col text-right text-danger">
              {{ (device | devicePrice: false:0:0:true:false | async) || '0 LE' }} :حساب الوقت قبل الخصم</small
            >
          </div>

          <div *ngIf="!device.session" class="form-group row">
            <div class="col-sm-10 offset-sm-0">
              <div class="form-check">
                <input
                  [(ngModel)]="isMulti"
                  [ngModelOptions]="{ standalone: true }"
                  class="form-check-input"
                  type="checkbox"
                  id="gridCheck1"
                />
                <label class="form-check-label" for="gridCheck1"> multi </label>
              </div>
            </div>
          </div>

          <hr />

          <div *ngIf="device.session" class="form-group row">
            <div class="col">
              <div class="input-group mb-3">
                <input
                  type="number"
                  step="1"
                  min="0"
                  max="100"
                  (ngModelChange)="ordersDiscount = $event; getDevicePrice()"
                  [(ngModel)]="ordersDiscount"
                  [ngModelOptions]="{ standalone: true }"
                  [value]="ordersDiscount"
                  class="form-control form-control-lg"
                  id="colFormLabelLg1"
                  placeholder=""
                />
                <span class="input-group-text p-0 p-1">% خصم الاوردرات</span>
              </div>
            </div>
            <div class="col">
              <div class="input-group mb-3">
                <input
                  type="number"
                  step="1"
                  min="0"
                  max="100"
                  (ngModelChange)="timeDiscount = $event; getDevicePrice()"
                  [(ngModel)]="timeDiscount"
                  [ngModelOptions]="{ standalone: true }"
                  [value]="timeDiscount"
                  class="form-control form-control-lg"
                  id="colFormLabelLg"
                  placeholder=""
                />
                <span class="input-group-text p-0 p-1">% خصم الوقت</span>
              </div>
            </div>
            <hr />

            <div *ngIf="device.session" class="form-group row">
              <label for="colFormLabelLg" class="col-sm-4 col-form-label col-form-label-lg">السعر الكلي</label>
              <div class="col-sm-8">
                <div class="input-group mb-3">
                  <input
                    type="email"
                    [(ngModel)]="totalPriceUser"
                    [ngModelOptions]="{ standalone: true }"
                    [value]="totalPriceUser"
                    class="form-control form-control-lg"
                    id="colFormLabelLg"
                    placeholder=""
                  />
                  <span class="input-group-text p-0 p-1">$</span>
                </div>
              </div>
            </div>
          </div>
        </form>
        <div *ngIf="device.session" class="form-group row">
          <div class="col-sm-10 offset-sm-0">
            <div class="form-check">
              <input [(ngModel)]="print" [ngModelOptions]="{ standalone: true }" class="form-check-input" type="checkbox" id="printBox" />
              <label class="form-check-label" for="printBox"> طباعة بعد الحفظ </label>
            </div>
          </div>
        </div>
        <button
          data-dismiss="modal"
          aria-label="Close"
          class="btn btn-primary col"
          (click)="device.session ? endSession() : startSession()"
        >
          {{ device.session ? 'ايقاف التشغيل' : 'بدا التشغيل' }}
        </button>
      </div>
    </div>
  </div>
</div>
