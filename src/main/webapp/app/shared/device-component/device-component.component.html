<div
  class="card border"
  [ngClass]="{
    'border-3': isSelected,
    'border-success border-active': device.session,
    'border-danger': !device.session
  }"
>
  <div class="card-body">
    <h5 class="card-title">
      <span style="cursor: pointer" data-toggle="modal" [attr.data-target]="'#modal' + device.id">
        <a (click)="OnDeviceClicked()" href="#" class="card-link"> {{ device.name }}</a></span
      >
      <i
        *ngIf="device.session"
        style="cursor: pointer"
        (click)="selectDevice(device)"
        class="float-right"
        class="fa fa-cart-arrow-down text-success float-right rounded p-1"
      ></i>
    </h5>
    <h6 class="card-subtitle mb-2 text-muted my-3">{{ device.type }}</h6>
    <span *ngIf="device.session && device.session.multi">
      <small class="border bg-light text-danger p-1 rounded"> <i class="fa fa-gamepad mr-2"> </i>{{ 'multi' }}</small>
    </span>
  </div>
  <div *ngIf="device.session" class="card-footer p-2">
    <a href="#" class="card-link">
      <label class="badge badge-success">{{ (device.session.start | countdowntimer | async) || '0 m' }}</label></a
    >
    <a href="#" class="card-link float-right m-0 pr-2">{{ (device | devicePrice | async) || 'EGP 0' }}</a>
  </div>
  <div *ngIf="!device.session" class="card-footer p-2">
    <a href="#" class="card-link float-left">
      <label class="badge badge-danger">{{ 'متوقف' }}</label></a
    >
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modal{{ device.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog rounded-lg border">
    <div class="modal-content">
      <div class="modal-header">
        <div class="card-body">
          <h5 class="card-title">
            <span style="cursor: pointer" data-toggle="modal" [attr.data-target]="'#modal' + device.id">
              <a href="#" class="card-link"> {{ device.name }}</a></span
            >
          </h5>
          <h6 class="card-subtitle mb-2 text-muted my-3">
            {{ device.type }}

            <span *ngIf="device.session && device.session.multi">
              -
              <small class="border bg-light text-danger p-1 rounded"> <i class="fa fa-gamepad mr-2"> </i>{{ 'multi' }}</small>
            </span>
          </h6>
        </div>
      </div>
      <div class="modal-body">
        <form>
          <div *ngIf="device.session" class="form-group row">
            <label for="staticEmail" class="col-sm-2 col-form-label">الوقت</label>
            <div class="col-sm-10" style="text-align: right">
              <label class="badge badge-success">{{ (device.session.start | countdowntimer | async) || '0 m' }}</label>
            </div>
          </div>
          <div *ngIf="device.session" class="form-group row">
            <label for="staticEmail" class="col-sm-2 col-form-label">السعر</label>
            <div class="col-sm-10" style="text-align: right">
              <a href="#" class="card-link">{{ (device | devicePrice: discount | async) || '0 LE' }}</a>
            </div>
          </div>

          <div *ngIf="device.session" class="form-group row">
            <label for="staticEmail" class="col-sm-2 col-form-label">وقت البدا</label>
            <div class="col-sm-10" style="text-align: right">
              <a href="#" class="card-link">{{ device.session.start | date: 'shortTime' }}</a>
            </div>
          </div>

          <div
            *ngIf="device.session"
            class="row text-center align-center justify-content-center card-subtitle m-3 rounded border border-2 shadow-sm"
          >
            <small class="d-block" *ngIf="device && device.session && device.session.ordersPrice" for="staticEmail" class="row"
              >{{ formateMoney(device.session.ordersPrice) }} : حساب الطلبات</small
            >

            <small class="d-block" *ngIf="device && device.session" for="staticEmail" class="row">
              {{ (device | devicePriceTimeOnly | async) || 'EGP 0' }} :حساب الوقت</small
            >
          </div>

          <div *ngIf="!device.session" class="form-group row">
            <div class="col-sm-10 offset-sm-0">
              <div class="form-check">
                <input
                  [(ngModel)]="isMulti"
                  [ngModelOptions]="{ standalone: true }"
                  class="form-check-input"
                  type="checkbox"
                  id="gridCheck1"
                />
                <label class="form-check-label" for="gridCheck1"> multi </label>
              </div>
            </div>
          </div>

          <hr />

          <div *ngIf="device.session" class="form-group row">
            <label for="colFormLabelLg" class="col-sm-4 col-form-label col-form-label-lg">السعر الكلي</label>
            <div class="col-sm-8">
              <div class="input-group mb-3">
                <input
                  type="email"
                  [(ngModel)]="totalPriceUser"
                  [ngModelOptions]="{ standalone: true }"
                  [value]="totalPriceUser"
                  class="form-control form-control-lg"
                  id="colFormLabelLg"
                  placeholder=""
                />
                <span class="input-group-text">$</span>
              </div>
            </div>
          </div>

          <div *ngIf="device.session" class="form-group row">
            <label for="colFormLabelLg" class="col-sm-4 col-form-label col-form-label-lg">الخصم</label>
            <div class="col-sm-8">
              <div class="input-group mb-3">
                <input
                  type="email"
                  (ngModelChange)="discount = $event; getDevicePrice()"
                  [(ngModel)]="discount"
                  [ngModelOptions]="{ standalone: true }"
                  [value]="discount"
                  class="form-control form-control-lg"
                  id="colFormLabelLg"
                  placeholder=""
                />
                <span class="input-group-text">%</span>
              </div>
            </div>
          </div>
        </form>
        <div *ngIf="device.session" class="form-group row">
          <div class="col-sm-10 offset-sm-0">
            <div class="form-check">
              <input [(ngModel)]="print" [ngModelOptions]="{ standalone: true }" class="form-check-input" type="checkbox" id="printBox" />
              <label class="form-check-label" for="printBox"> طباعة بعد الحفظ </label>
            </div>
          </div>
        </div>
        <button
          data-dismiss="modal"
          aria-label="Close"
          class="btn btn-primary col"
          (click)="device.session ? endSession() : startSession()"
        >
          {{ device.session ? 'ايقاف التشغيل' : 'بدا التشغيل' }}
        </button>
      </div>
    </div>
  </div>
</div>
